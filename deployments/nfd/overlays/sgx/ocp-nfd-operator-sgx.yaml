apiVersion: nfd.openshift.io/v1
kind: NodeFeatureDiscovery
metadata:
  name: nfd-instance
  namespace: openshift-nfd
spec:
  extraLabelNs:
    - sgx.intel.com
  resourceLabels:
    - sgx.intel.com/epc
  operand:
    image: quay.io/openshift/origin-node-feature-discovery:4.10
    imagePullPolicy: Always
    servicePort: 12000
  workerConfig:
    configData: |
      core:
        sleepInterval: 60s
      sources:
        pci:
          deviceClassWhitelist:
            - "0200"
            - "03"
            - "12"
          deviceLabelFields:
            - "vendor"
  customConfig:
    configData: |
      - name: "intel.sgx"
        labels:
          intel.sgx: "true"
        matchFeatures:
          - feature: cpu.cpuid
            matchExpressions:
              SGX: {op: Exists}
              SGXLC: {op: Exists}
          - feature: cpu.sgx
            matchExpressions:
              enabled: {op: IsTrue}
          - feature: kernel.config
            matchExpressions:
              X86_SGX: {op: Exists}   
